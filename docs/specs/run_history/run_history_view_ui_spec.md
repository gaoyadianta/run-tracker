# 跑步历史轨迹查看页 - UI/交互结构稿

基于 `docs/specs/run_history/1.png`、`2.jpg`、`3.jpg`、`4.jpg` 四张参考图，重构“跑步历史轨迹查看页”的 UI/交互结构。核心思路：**地图轨迹为底层，信息层以可滑动 Bottom Sheet 叠加**。

---

## 1. 设计目标
- 地图轨迹沉浸感强，信息层“贴图而不压图”
- 重要指标优先露出（距离、配速、用时）
- 分段与图表分析可滑动进入，避免首屏信息过载
- 回放可一键触发，轨迹与高亮同步

---

## 2. 页面结构总览

### 2.1 底层：地图轨迹层（全屏）
- 路线：渐变色轨迹（绿→黄→红，对应配速/心率/爬升）
- 起点/终点：旗标 + 文案（Start / End）
- 回放指示：当前点 + 已走过路径加粗
- 右侧浮动按钮：定位 / 地图模式 / 比例尺（或指南针）

### 2.2 上层：信息叠加层（Bottom Sheet）
- 背景：半透明深色卡片
- 圆角：顶部 20dp
- 3 段高度：折叠 / 半屏 / 全屏
- 滑动时地图仍可见（全屏状态可限制地图交互以防误触）

---

## 3. 三段状态设计（对应 4 张图）

### 3.1 折叠态（图 1）
**高度：约 30–35%**
- 头像 + 昵称 + 日期时间
- 距离大数字（核心视觉锚点）
- 指标区：平均配速 / 用时 / 爬升 / 步数（4 宫格）
- 动态轨迹按钮（右侧）
- 主 CTA：分享记录

### 3.2 半屏态（图 2）
**高度：约 55–60%**
在折叠态基础上新增两块：
- 配速概览卡：最快 / 平均 / 最慢
- 分段配速入口卡（更多 >）
- 底部仍保留：分享记录

### 3.3 全屏态（图 3 & 图 4）
**高度：约 85–90%**
- 分段配速列表（1km 纵向列表，配速条形）
- 步频 / 步幅卡片
- 多指标曲线图（配速 / 步频 / 心率 / 海拔）
- 底部固定：分享记录按钮

---

## 4. 组件结构拆分（概念树）

```
RunHistoryDetailScreen
├─ MapLayer
│  ├─ RoutePolyline (Gradient)
│  ├─ StartMarker / EndMarker
│  ├─ PlaybackMarker + ProgressPolyline
│  └─ FloatingMapActions
└─ OverlaySheet (Bottom Sheet)
   ├─ HeaderCard (avatar + name + date + playback)
   ├─ DistanceBlock (large distance)
   ├─ StatsRow (avg pace / duration / elevation / steps)
   ├─ PaceSummaryCard (fast/avg/slow)     [half/expanded]
   ├─ SplitPaceList (km list + bars)      [expanded]
   ├─ CadenceCard (cadence / stride)      [expanded]
   ├─ MetricsChartCard (tabbed charts)    [expanded]
   └─ ShareCTA (fixed bottom button)
```

---

## 5. 关键交互说明

### 5.1 Bottom Sheet 滑动
- 折叠 → 半屏 → 全屏（三段）
- 全屏时地图可设置为只读，避免误触

### 5.2 动态轨迹回放
- 入口在折叠/半屏状态右侧
- 播放中：路线加粗逐步增长，当前点沿路线移动
- 播放结束：停在终点，保持终点标记稳定

### 5.3 分享
- 全局固定 CTA 按钮
- 按钮始终可见（半屏/全屏）

---

## 6. 视觉与层级

### 6.1 颜色
- 背景卡片：#1F2228（透明度 0.92）
- 轨迹渐变：绿→黄→红
- CTA：高对比红色（与示例一致）

### 6.2 文字层级
- 距离：44–52sp（最大字号）
- 配速/用时：20–24sp
- 标签/说明：12–14sp

### 6.3 间距
- 卡片内边距：16–20dp
- 模块间距：12–16dp
- 底部 CTA 间距：16dp

---

## 7. 动效建议
- Bottom Sheet：弹性缓动（240–320ms）
- 回放路径：每帧平滑过渡（避免闪烁）
- 地图按钮：轻微缩放/阴影浮起反馈

---

## 8. 数据映射提醒
- 配速颜色：相对平均配速，快=绿、慢=红
- 分段条形：长度按 km 时间比例
- 图表支持联动地图高亮点

---

## 9. 后续落地建议
- 先实现折叠/半屏/全屏三段结构
- 再接入分段列表与图表
- 最后做回放与地图联动细节优化

